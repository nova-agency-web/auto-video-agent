name: Agent vidÃ©o automatique

on:
  workflow_dispatch:
    inputs:
      ACCOUNT:
        description: "Compte ciblÃ© (libre)"
        required: false
        default: "trucs-malins"
      POSTS_TO_PUBLISH:
        description: "Nombre de posts Ã  traiter"
        required: false
        default: "1"
      DRY_RUN:
        description: "Ne pas publier (True/False)"
        required: false
        default: "False"

jobs:
  courir:
    runs-on: ubuntu-latest

    env:
      ACCOUNT: ${{ inputs.ACCOUNT }}
      POSTS_TO_PUBLISH: ${{ inputs.POSTS_TO_PUBLISH }}
      DRY_RUN: ${{ inputs.DRY_RUN }}
      # Secrets Ã  renseigner dans Settings > Secrets and variables > Actions
      TIKTOK_COOKIE: ${{ secrets.TIKTOK_COOKIE }}
      TIKTOK_UA: ${{ secrets.TIKTOK_UA }}

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Upgrade pip + install deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          # Playwright + browsers
          python -m playwright install --with-deps chromium

      - name: Run python main.py
        shell: bash
        run: |
          set -e
          python main.py

      # ðŸ‘‡ Toujours publier trace.zip (mÃªme si le run Ã©choue)
      - name: Upload Playwright trace (always)
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: trace
          path: trace.zip
